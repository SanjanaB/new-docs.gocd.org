<!DOCTYPE html>

<html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configure the Kubernetes Elastic Agent plugin | GoCD User Documentation</title>

<meta name="description" content="GoCD is an open source continuous delivery server that helps organizations increase productivity and deliver high quality software through automation."/>
<meta name="keywords" content="continuous delivery, software, continuous integration, open source, blog, software development, tools, automation, deployment pipelines, devops, techniques"/>
<link rel="canonical" href="https://gocd.github.io/new-docs.gocd.org/current//gocd_on_kubernetes/gocd_helm_chart/configure_k8s_ea_plugin.html"/>
<script async src="../../javascripts/_gdpr-banner.js" type="text/javascript"></script>
<link rel="stylesheet" href="../../normalize.min.css"/>

<link rel="stylesheet" href="../../book.min.3ebd28c907bab09ffb3238a8742a29b1191cc675d635ee7fb6f3fa4d7f9d4ed2.css"/>
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<a href="https://www.gocd.org"> <img src="../../svg/product_ui_logo_go.svg" class="icon" /></a>


    <ul>
<li><a href="../../"><strong>Introduction</strong></a></li>
<li><a href="../../introduction.html"><strong>Concepts In GoCD</strong></a>

<ul>
<li><a href="../../introduction/concepts_in_go.html">Concepts In GoCD</a></li>
</ul></li>
<li><a href="../../navigation.html"><strong>GoCD Tour</strong></a>

<ul>
<li><a href="../../navigation/pipelines_dashboard_page.html">Pipeline Dashboard</a></li>
<li><a href="../../navigation/agents_page.html">Agents</a></li>
<li><a href="../../navigation/agent_details.html">Agent Details</a></li>
<li><a href="../../navigation/pipeline_activity_page.html">Pipeline Activity</a></li>
<li><a href="../../navigation/stage_details_page.html">Stage Details</a></li>
<li><a href="../../navigation/job_details_page.html">Job Details</a></li>
<li><a href="../../navigation/administration_page.html">Administration</a></li>
<li><a href="../../navigation/server_details_page.html">Server Details</a></li>
<li><a href="../../navigation/environments_page.html">Environments</a></li>
<li><a href="../../navigation/value_stream_map.html">Value Stream Map</a></li>
</ul></li>
<li><a href="../../installation.html"><strong>Installing GoCD</strong></a>

<ul>
<li><a href="../../installation/system_requirements.html">System requirements</a></li>
<li><a href="../../installation/installing_go_server.html">Installing GoCD Server</a>

<ul>
<li><a href="../../installation/install/server/linux.html">Linux</a></li>
<li><a href="../../installation/install/server/windows.html">Windows</a></li>
<li><a href="../../installation/install/server/osx.html">Mac OS X</a></li>
<li><a href="../../installation/install/server/zip.html">Generic Zip</a></li>
</ul></li>
<li><a href="../../installation/installing_go_agent.html">Installing GoCD Agent</a>

<ul>
<li><a href="../../installation/install/agent/linux.html">Linux</a></li>
<li><a href="../../installation/install/agent/windows.html">Windows</a></li>
<li><a href="../../installation/install/agent/osx.html">Mac OS X</a></li>
<li><a href="../../installation/install/agent/zip.html">Generic Zip</a></li>
</ul></li>
<li><a href="../../installation/upgrading_go.html">Upgrading GoCD</a></li>
<li><a href="../../installation/configuring_server_details.html">Configuring Server Details</a></li>
<li><a href="../../installation/configure-reverse-proxy.html">Configure a Reverse Proxy</a></li>
<li><a href="../../installation/configure-agent-proxy.html">Configure an agent with proxy</a></li>
<li><a href="../../installation/ssl_tls_config.html">Configuring SSL/TLS</a>

<ul>
<li><a href="../../installation/ssl_tls/setting_up_ciphers.html">Customizing Ciphers</a></li>
<li><a href="../../installation/ssl_tls/custom_server_certificate.html">Change SSL Certificates</a></li>
<li><a href="../../installation/ssl_tls/end_to_end_transport_security.html">End to end transport security</a></li>
<li><a href="../../installation/ssl_tls/configuring_hsts_header.html">Configuring HSTS Header</a></li>
</ul></li>
<li><a href="../../installation/performance_tuning.html">Performance Tuning</a></li>
<li><a href="../../installation/hardware_specifications.html">Hardware Specifications</a></li>
<li><a href="../../installation/troubleshooting.html">Troubleshooting</a></li>
</ul></li>
<li><a href="../../configuration.html"><strong>Configuration</strong></a>

<ul>
<li><a href="../../configuration/quick_pipeline_setup.html">Setup a New Pipeline</a></li>
<li><a href="../../configuration/managing_pipelines.html">Managing Pipelines</a></li>
<li><a href="../../configuration/managing_dependencies.html">Managing Dependencies</a></li>
<li><a href="../../configuration/managing_a_build_cloud.html">Managing Agents</a></li>
<li><a href="../../configuration/managing_environments.html">Managing Environments</a></li>
<li><a href="../../configuration/build_labelling.html">Pipeline Labelling</a></li>
<li><a href="../../configuration/pipeline_scheduling.html">Pipeline Scheduling</a></li>
<li><a href="../../configuration/admin_use_parameters_in_configuration.html">Parameterize a Pipeline</a></li>
<li><a href="../../configuration/admin_use_custom_pipeline_label.html">Customize a Pipeline Label</a></li>
<li><a href="../../configuration/admin_clone_pipeline.html">Clone a Pipeline</a></li>
<li><a href="../../configuration/admin_lock_pipelines.html">Lock a Pipeline</a></li>
<li><a href="../../configuration/admin_add_material.html">Add Material to Existing Pipeline</a></li>
<li><a href="../../configuration/admin_add_stage.html">Add Stage to Existing Pipeline</a></li>
<li><a href="../../configuration/admin_add_job.html">Add job to Existing Stage</a></li>
<li><a href="../../configuration/admin_add_task.html">Add task to Existing Job</a></li>
<li><a href="../../configuration/pipeline_templates.html">Pipeline Templates</a></li>
<li><a href="../../configuration/elastic_agents.html">Elastic Agents</a></li>
<li><a href="../../configuration/dev_choose_when_stage_runs.html">Choose When a Stage Runs</a></li>
<li><a href="../../configuration/admin_timer.html">Timer Trigger</a></li>
<li><a href="../../configuration/job_timeout.html">Job Timeout</a></li>
<li><a href="../../configuration/managing_users.html">Managing Users</a></li>
<li><a href="../../configuration/dev_authentication.html">Authentication</a></li>
<li><a href="../../configuration/dev_authorization.html">Authorizing Users</a></li>
<li><a href="../../configuration/delegating_group_administration.html">Delegating Group Administration</a></li>
<li><a href="../../configuration/pipeline_group_admin_config.html">Pipeline Group Administration</a></li>
<li><a href="../../configuration/dev_upload_test_report.html">Publish Reports and Artifacts</a></li>
<li><a href="../../configuration/managing_artifacts_and_reports.html">Managing Artifacts and Reports</a></li>
<li><a href="../../configuration/delete_artifacts.html">Auto Delete Artifacts</a></li>
<li><a href="../../configuration/ui_testing.html">UI Testing</a></li>
<li><a href="../../configuration/admin_mailhost_info.html">Mailhost Information</a></li>
<li><a href="../../configuration/dev_notifications.html">Notifications</a></li>
<li><a href="../../configuration/tfs_config.html">TFS Material configuration</a></li>
<li><a href="../../configuration/configuration_reference.html">Reference</a></li>
<li><a href="../../configuration/schema.html">Schema</a></li>
</ul></li>
<li><a href="../../advanced_usage.html"><strong>Advanced Usage</strong></a>

<ul>
<li><a href="../../advanced_usage/pipelines_as_code.html">Pipelines as code</a></li>
<li><a href="../../advanced_usage/agent_auto_register.html">Auto Register a Remote Agent</a></li>
<li><a href="../../advanced_usage/admin_spawn_multiple_jobs.html">Spawn multiple instances of a Job</a></li>
<li><a href="../../advanced_usage/admin_install_multiple_agents.html">Multiple Agents on One Machine</a></li>
<li><a href="../../advanced_usage/dev_clean_up_when_cancel.html">Clean on Task Cancel</a></li>
<li><a href="../../advanced_usage/dev_conditional_task_execution.html">Conditional Task Execution</a></li>
<li><a href="../../advanced_usage/trigger_with_options.html">Trigger With Options</a></li>
<li><a href="../../advanced_usage/fan_in.html">Fan In</a></li>
<li><a href="../../advanced_usage/properties.html">Properties</a></li>
<li><a href="../../advanced_usage/logging.html">Logging</a></li>
<li><a href="../../advanced_usage/compare_pipelines.html">Compare Builds</a></li>
<li><a href="../../advanced_usage/stage_duration_chart.html">Graphs</a></li>
<li><a href="../../advanced_usage/command_repository.html">Command Repository</a></li>
<li><a href="../../advanced_usage/one_click_backup.html">Backup GoCD Server</a></li>
<li><a href="../../advanced_usage/cron_backup.html">Timer Based GoCD Server Backup</a></li>
<li><a href="../../advanced_usage/config_repo.html">Config Repository</a></li>
<li><a href="../../advanced_usage/other_config_options.html">Other Config Options</a></li>
<li><a href="../../advanced_usage/agent-health-check-api.html">Agent Health Check API</a></li>
<li><a href="../../advanced_usage/maintenance_mode.html">Maintenance Mode</a><br /></li>
</ul></li>
<li><a href="../../integration.html"><strong>Integrating GoCD With Other Tools</strong></a><br /></li>
<li><a href="../../extension_points.html"><strong>Extension Points Of GoCD</strong></a>

<ul>
<li><a href="../../extension_points/plugin_user_guide.html">Plugin User Guide</a></li>
<li><a href="../../extension_points/package_repository_extension.html">Package Repository Extension</a></li>
<li><a href="../../extension_points/yum_repository_poller.html">Yum Repository Poller</a></li>
<li><a href="../../extension_points/scm_extension.html">SCM Extension</a></li>
<li><a href="../../extension_points/task_extension.html">Task Extension</a></li>
<li><a href="../../extension_points/notification_extension.html">Notification Extension</a></li>
<li><a href="../../extension_points/configrepo_extension.html">Configuration repository Extension</a></li>
</ul></li>
<li><a href="../../gocd_on_kubernetes.html"><strong>GoCD on Kubernetes</strong></a>

<ul>
<li><a href="../../gocd_on_kubernetes/introduction.html">Introduction</a></li>
<li><a href="../../gocd_on_kubernetes/gocd_helm_chart/setup_and_configuration.html">Setup and configuration</a>

<ul>
<li><a href="../../gocd_on_kubernetes/gocd_helm_chart/setup.html">Setup</a></li>
<li><a href="../../gocd_on_kubernetes/gocd_helm_chart/configure_cluster.html">Configure your Kubernetes Cluster</a></li>
<li><a href="../../gocd_on_kubernetes/gocd_helm_chart/helm_install.html">Install the GoCD Helm chart</a></li>
</ul></li>
<li><a href="../../gocd_on_kubernetes/designing_a_cd_pipeline.html">Designing a CD Pipeline</a>

<ul>
<li><a href="../../gocd_on_kubernetes/designing_a_cd_pipeline/creating_a_build_pipeline.html">Create a pipeline to build application</a></li>
<li><a href="../../gocd_on_kubernetes/designing_a_cd_pipeline/creating_a_test_pipeline.html">Create a pipeline to test the built application</a></li>
<li><a href="../../gocd_on_kubernetes/designing_a_cd_pipeline/creating_a_deploy_pipeline.html">Create a pipeline to deploy on Kubernetes</a></li>
<li><a href="../../gocd_on_kubernetes/designing_a_cd_pipeline/docker_workflows.html">Docker workflows</a></li>
<li><a href="../../gocd_on_kubernetes/gocd_helm_chart/configure_k8s_ea_plugin.html">Configure the Kubernetes Elastic Agent plugin</a></li>
</ul></li>
<li><a href="../../gocd_on_kubernetes/gocd_helm_chart/troubleshooting.html">Troubleshooting</a></li>
</ul></li>
<li><a href="../../faq.html"><strong>FAQ/Troubleshooting</strong></a>

<ul>
<li><a href="../../faq/ordering_of_pipelines.html">Ordering of Pipelines</a></li>
<li><a href="../../faq/stage_old_config.html">Historical Configuration</a></li>
<li><a href="../../faq/concurrent_config_modifications.html">Concurrent Modifications to Config</a></li>
<li><a href="../../faq/dev_understand_why_build_broken.html">Why the Build is Broken?</a></li>
<li><a href="../../faq/dev_see_artifact_as_tab.html">See artifacts as sub-tabs</a></li>
<li><a href="../../faq/dev_save_properties.html">Save Properties for a Build</a></li>
<li><a href="../../faq/environment_variables.html">Using Environment variables</a></li>
<li><a href="../../faq/rm_deploy_to_environment.html">Deploy to an environment</a></li>
<li><a href="../../faq/tester_what_has_changed.html">See changes in new binary</a></li>
<li><a href="../../faq/dependency_management.html">Run Tests against new Builds</a></li>
<li><a href="../../faq/rm_what_is_deployed.html">Check What&rsquo;s Deployed</a></li>
<li><a href="../../faq/deploy_a_specific_build_to_an_environment.html">Deploy a Specific Build</a></li>
<li><a href="../../faq/agent_guid_issue.html">Clone/Copy an Existing Agents</a></li>
<li><a href="../../faq/job_rerun.html">How do I re-run jobs?</a></li>
<li><a href="../../faq/material_update_hung.html">Go unable to poll for changes</a></li>
<li><a href="../../faq/artifact_integrity.html">Artifact integrity verification</a></li>
<li><a href="../../faq/notifications_page.html">Email Notifications</a></li>
<li><a href="../../faq/admin_out_of_disk_space.html">Running out of Disk Space</a></li>
<li><a href="../../faq/docker_container_ssh_keys.html">Configure SSH Keys for dockerized GoCD</a></li>
</ul></li>
<li><a href="../../beta.html"><strong>Beta features</strong></a>

<ul>
<li><a href="../../beta/comment_on_pipeline_run.html">Comment on a pipeline run</a><br /></li>
</ul></li>
<li><a href="../../release_history.html"><strong>Release History</strong></a>

<ul>
<li><a href="../../release_history/whats_new_in_go.html">What&rsquo;s New in Go</a><br /></li>
</ul></li>
</ul>




</nav>
    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="../../svg/menu.svg" />
  </label>
  <strong>Configure the Kubernetes Elastic Agent plugin</strong>
</header>

      
<article class="markdown">

<h1 id="kubernetes-elastic-agent-plugin">Kubernetes elastic agent plugin</h1>

<blockquote>
<p>GoCD agents are &ldquo;workers&rdquo; and execute tasks that make up jobs, stages and the pipeline. GoCD <a href="https://www.gocd.org/elastic-agents">Elastic agents</a> spin up agents on demand, depending on the intensity of the tasks and availability of processing power.</p>
</blockquote>

<p>The Kubernetes elastic agent plugin is bundled with the GoCD Helm chart. This plugin spins up GoCD agent pods in the Kubernetes cluster in response to build workload.</p>

<h2 id="configure-the-kubernetes-elastic-agent-plugin">Configure the Kubernetes elastic agent plugin</h2>

<p>We need to configure the plugin to point to the right Kubernetes cluster. Navigate to the plugins page from the Admin dropdown.</p>

<p><img src="../../images/gocd-helm-chart/plugins_page.png" alt="" /></p>

<p>Click on the &lsquo;gear&rsquo; icon for the Kubernetes Elastic Agent plugin to edit its settings.</p>

<p><img src="../../images/gocd-helm-chart/plugin_settings.png" alt="" /></p>

<p>This is a rundown of the attributes of the Kubernetes elastic agent</p>

<ol>
<li>The GoCD Server URL is required for the agents brought up by the plugin to connect to the GoCD server. A private GoCD server IP within the Kubernetes cluster can be obtained and specified with the following command.
<br /></li>
</ol>

<pre><code class="language-bash">     echo &quot;https://$(kubectl --namespace=gocd get service gocd-server -o jsonpath='{.spec.clusterIP}'):8154/go&quot;
</code></pre>

<ol>
<li>The Cluster URL indicates the Kubernetes cluster in which the GoCD agent pods must be brought up. This can be obtained by running the following command
<br /></li>
</ol>

<pre><code class="language-bash">     kubectl cluster-info
</code></pre>

<p>The <code>Kubernetes master</code> url is the Cluster URL.</p>

<ol>
<li><p>The Kubernetes namespace where the helm chart was installed needs to be specified. As mentioned in the installation guide above, the namespace we have used is <code>gocd</code>.</p></li>

<li><p>The Service Account token specified must be associated with a service account that has the following privileges</p>

<ul>
<li>nodes: list, get</li>
<li>events: list, watch</li>
<li>namespace: list, get</li>
<li>pods, pods/log: *</li>
</ul></li>
</ol>

<p>The token can be obtained by:</p>

<pre><code class="language-bash">     secret_name=$(kubectl --namespace=gocd get serviceaccount gocd -o jsonpath=&quot;{.secrets[0].name}&quot;)
     kubectl --namespace=gocd get secret $secret_name -o jsonpath=&quot;{.data['token']}&quot; | base64 --decode
</code></pre>

<ol>
<li>Once you save your configuration, navigate to the plugin status report page from the plugins page and confirm that you don&rsquo;t have configuration errors.</li>
</ol>

<p><img src="../../images/gocd-helm-chart/plugin_status.png" alt="" /></p>

<h2 id="create-an-elastic-profile">Create an elastic profile</h2>

<blockquote>
<p>An elastic agent plugin spins up GoCD agents on the fly. It needs to know what type of agent to spin up. An elastic profile specifies the type of GoCD Agent to be used by the elastic agent plugin. Using this, you can bring up different kinds of agent pods within the same cluster to run different kinds of jobs.</p>
</blockquote>

<p>To configure an elastic profile, go to Admin -&gt; Elastic Agent Profiles and click on the &lsquo;Add&rsquo; button to add a new profile.</p>

<ol>
<li>Choose an ID name for the profile. This profile ID will be made use of when we create the <a href="../designing_a_cd_pipeline/creating_a_build_pipeline.html#associate-job-with-the-elastic-profile">build_and_publish_image</a> pipeline and <a href="../designing_a_cd_pipeline/creating_a_deploy_pipeline.html#associate-job-with-the-elastic-profile">deploy_app_to_cluster</a> pipeline.</li>
<li>Choose a GoCD agent image. For this example, since we are building Docker images, we recommend using <code>gocd/gocd-agent-docker-dind:v18.2.0</code>.</li>
</ol>

<p><em>Tip: Check the &lsquo;Privileged mode&rsquo; checkbox which is essential to run the <a href="../designing_a_cd_pipeline/docker_workflows.html">Docker in Docker</a> image.</em></p>

<p><img src="../../images/gocd-helm-chart/profile.png" alt="" /></p>

<p>You can see all of our docker images (both server and agent) <a href="https://hub.docker.com/r/gocd/">here</a>.</p>

<p>Once you&rsquo;ve created an elastic profile, you can begin to associate the profile to jobs inorder to run them.</p>
</article>

      
<div class="align-center book-git-footer justify-end">
  
  
  <div>
    <a href="https://github.com/gocd/new-docs.gocd.org/edit/master/content/gocd_on_kubernetes/gocd_helm_chart/configure_k8s_ea_plugin.md" target="_blank" rel="noopener">
      <img src="../../svg/code-fork.svg" /> Edit this page
    </a>
  </div>
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#kubernetes-elastic-agent-plugin">Kubernetes elastic agent plugin</a>
<ul>
<li><a href="#configure-the-kubernetes-elastic-agent-plugin">Configure the Kubernetes elastic agent plugin</a></li>
<li><a href="#create-an-elastic-profile">Create an elastic profile</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
