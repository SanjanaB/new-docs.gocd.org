<!DOCTYPE html>

<html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configuration repository Extension | GoCD User Documentation</title>

<meta name="description" content="Move pipeline configurations out of GoCD and its cruise-config.xml file so that you can modify them externally."/>
<meta name="keywords" content="[pipeline configurations, gocd pipelines, build pipelines, config as code, config plugins, merging pipelines, source repository]"/>
<link rel="canonical" href="https://gocd.github.io/new-docs.gocd.org/current//extension_points/configrepo_extension.html"/>
<script async src="../javascripts/_gdpr-banner.js" type="text/javascript"></script>
<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet"/>
<link rel="stylesheet" href="../normalize.min.css"/>

<link rel="stylesheet" href="../book.min.87a2ae978f4eef197028ff1dc9c46e406d1b1133dcefddfe618d4d6d73fc362e.css"/>
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">



    <ul>
<li><a href="../"><strong>Introduction</strong></a></li>
<li><a href="../navigation.html"><strong>GoCD Tour</strong></a>

<ul>
<li><a href="../navigation/pipelines_dashboard_page.html">Pipeline Dashboard</a></li>
<li><a href="../navigation/agents_page.html">Agents</a></li>
<li><a href="../navigation/agent_details.html">Agent Details</a></li>
<li><a href="../navigation/pipeline_activity_page.html">Pipeline Activity</a></li>
<li><a href="../navigation/stage_details_page.html">Stage Details</a></li>
<li><a href="../navigation/job_details_page.html">Job Details</a></li>
<li><a href="../navigation/administration_page.html">Administration</a></li>
<li><a href="../navigation/server_details_page.html">Server Details</a></li>
<li><a href="../navigation/environments_page.html">Environments</a></li>
<li><a href="../navigation/value_stream_map.html">Value Stream Map</a></li>
</ul></li>
<li><a href="../configuration.html"><strong>Configuration</strong></a>

<ul>
<li><a href="../configuration/quick_pipeline_setup.html">Setup a New Pipeline</a></li>
<li><a href="../configuration/managing_pipelines.html">Managing Pipelines</a></li>
<li><a href="../configuration/managing_dependencies.html">Managing Dependencies</a></li>
<li><a href="../configuration/managing_a_build_cloud.html">Managing Agents</a></li>
<li><a href="../configuration/managing_environments.html">Managing Environments</a></li>
<li><a href="../configuration/build_labelling.html">Pipeline Labelling</a></li>
<li><a href="../configuration/pipeline_scheduling.html">Pipeline Scheduling</a></li>
<li><a href="../configuration/admin_use_parameters_in_configuration.html">Parameterize a Pipeline</a></li>
<li><a href="../configuration/admin_use_custom_pipeline_label.html">Customize a Pipeline Label</a></li>
<li><a href="../configuration/admin_clone_pipeline.html">Clone a Pipeline</a></li>
<li><a href="../configuration/admin_lock_pipelines.html">Lock a Pipeline</a></li>
<li><a href="../configuration/admin_add_material.html">Add Material to Existing Pipeline</a></li>
<li><a href="../configuration/admin_add_stage.html">Add Stage to Existing Pipeline</a></li>
<li><a href="../configuration/admin_add_job.html">Add job to Existing Stage</a></li>
<li><a href="../configuration/admin_add_task.html">Add task to Existing Job</a></li>
<li><a href="../configuration/pipeline_templates.html">Pipeline Templates</a></li>
<li><a href="../configuration/elastic_agents.html">Elastic Agents</a></li>
<li><a href="../configuration/dev_choose_when_stage_runs.html">Choose When a Stage Runs</a></li>
<li><a href="../configuration/admin_timer.html">Timer Trigger</a></li>
<li><a href="../configuration/job_timeout.html">Job Timeout</a></li>
<li><a href="../configuration/managing_users.html">Managing Users</a></li>
<li><a href="../configuration/dev_authentication.html">Authentication</a></li>
<li><a href="../configuration/dev_authorization.html">Authorizing Users</a></li>
<li><a href="../configuration/delegating_group_administration.html">Delegating Group Administration</a></li>
<li><a href="../configuration/pipeline_group_admin_config.html">Pipeline Group Administration</a></li>
<li><a href="../configuration/dev_upload_test_report.html">Publish Reports and Artifacts</a></li>
<li><a href="../configuration/managing_artifacts_and_reports.html">Managing Artifacts and Reports</a></li>
<li><a href="../configuration/delete_artifacts.html">Auto Delete Artifacts</a></li>
<li><a href="../configuration/ui_testing.html">UI Testing</a></li>
<li><a href="../configuration/admin_mailhost_info.html">Mailhost Information</a></li>
<li><a href="../configuration/dev_notifications.html">Notifications</a></li>
<li><a href="../configuration/tfs_config.html">TFS Material configuration</a></li>
<li><a href="../configuration/configuration_reference.html">Reference</a></li>
<li><a href="../configuration/schema.html">Schema</a></li>
</ul></li>
<li><a href="../advanced_usage.html"><strong>Advanced Usage</strong></a>

<ul>
<li><a href="../advanced_usage/pipelines_as_code.html">Pipelines as code</a></li>
<li><a href="../advanced_usage/agent_auto_register.html">Auto Register a Remote Agent</a></li>
<li><a href="../advanced_usage/admin_spawn_multiple_jobs.html">Spawn multiple instances of a Job</a></li>
<li><a href="../advanced_usage/admin_install_multiple_agents.html">Multiple Agents on One Machine</a></li>
<li><a href="../advanced_usage/dev_clean_up_when_cancel.html">Clean on Task Cancel</a></li>
<li><a href="../advanced_usage/dev_conditional_task_execution.html">Conditional Task Execution</a></li>
<li><a href="../advanced_usage/trigger_with_options.html">Trigger With Options</a></li>
<li><a href="../advanced_usage/fan_in.html">Fan In</a></li>
<li><a href="../advanced_usage/properties.html">Properties</a></li>
<li><a href="../advanced_usage/logging.html">Logging</a></li>
<li><a href="../advanced_usage/compare_pipelines.html">Compare Builds</a></li>
<li><a href="../advanced_usage/stage_duration_chart.html">Graphs</a></li>
<li><a href="../advanced_usage/command_repository.html">Command Repository</a></li>
<li><a href="../advanced_usage/one_click_backup.html">Backup GoCD Server</a></li>
<li><a href="../advanced_usage/cron_backup.html">Timer Based GoCD Server Backup</a></li>
<li><a href="../advanced_usage/config_repo.html">Config Repository</a></li>
<li><a href="../advanced_usage/other_config_options.html">Other Config Options</a></li>
<li><a href="../advanced_usage/agent-health-check-api.html">Agent Health Check API</a></li>
<li><a href="../advanced_usage/maintenance_mode.html">Maintenance Mode</a><br /></li>
</ul></li>
<li><a href="../extension_points.html"><strong>Extension Points Of GoCD</strong></a>

<ul>
<li><a href="../extension_points/plugin_user_guide.html">Plugin User Guide</a></li>
<li><a href="../extension_points/package_repository_extension.html">Package Repository Extension</a></li>
<li><a href="../extension_points/yum_repository_poller.html">Yum Repository Poller</a></li>
<li><a href="../extension_points/scm_extension.html">SCM Extension</a></li>
<li><a href="../extension_points/task_extension.html">Task Extension</a></li>
<li><a href="../extension_points/notification_extension.html">Notification Extension</a></li>
<li><a href="../extension_points/configrepo_extension.html">Configuration repository Extension</a></li>
</ul></li>
<li><a href="../gocd_on_kubernetes.html"><strong>GoCD on Kubernetes</strong></a>

<ul>
<li><a href="../gocd_on_kubernetes/introduction.html">Introduction</a></li>
<li><a href="../gocd_on_kubernetes/gocd_helm_chart/setup_and_configuration.html">Setup and configuration</a>

<ul>
<li><a href="../gocd_on_kubernetes/gocd_helm_chart/setup.html">Setup</a></li>
<li><a href="../gocd_on_kubernetes/gocd_helm_chart/configure_cluster.html">Configure your Kubernetes Cluster</a></li>
<li><a href="../gocd_on_kubernetes/gocd_helm_chart/helm_install.html">Install the GoCD Helm chart</a></li>
</ul></li>
<li><a href="../gocd_on_kubernetes/designing_a_cd_pipeline.html">Designing a CD Pipeline</a>

<ul>
<li><a href="../gocd_on_kubernetes/designing_a_cd_pipeline/creating_a_build_pipeline.html">Create a pipeline to build application</a></li>
<li><a href="../gocd_on_kubernetes/designing_a_cd_pipeline/creating_a_test_pipeline.html">Create a pipeline to test the built application</a></li>
<li><a href="../gocd_on_kubernetes/designing_a_cd_pipeline/creating_a_deploy_pipeline.html">Create a pipeline to deploy on Kubernetes</a></li>
<li><a href="../gocd_on_kubernetes/designing_a_cd_pipeline/docker_workflows.html">Docker workflows</a></li>
<li><a href="../gocd_on_kubernetes/gocd_helm_chart/configure_k8s_ea_plugin.html">Configure the Kubernetes Elastic Agent plugin</a></li>
</ul></li>
<li><a href="../gocd_on_kubernetes/gocd_helm_chart/troubleshooting.html">Troubleshooting</a></li>
</ul></li>
<li><a href="../faq.html"><strong>FAQ/Troubleshooting</strong></a>

<ul>
<li><a href="../faq/ordering_of_pipelines.html">Ordering of Pipelines</a></li>
<li><a href="../faq/stage_old_config.html">Historical Configuration</a></li>
<li><a href="../faq/concurrent_config_modifications.html">Concurrent Modifications to Config</a></li>
<li><a href="../faq/dev_understand_why_build_broken.html">Why the Build is Broken?</a></li>
<li><a href="../faq/dev_see_artifact_as_tab.html">See artifacts as sub-tabs</a></li>
<li><a href="../faq/dev_save_properties.html">Save Properties for a Build</a></li>
<li><a href="../faq/environment_variables.html">Using Environment variables</a></li>
<li><a href="../faq/rm_deploy_to_environment.html">Deploy to an environment</a></li>
<li><a href="../faq/tester_what_has_changed.html">See changes in new binary</a></li>
<li><a href="../faq/dependency_management.html">Run Tests against new Builds</a></li>
<li><a href="../faq/rm_what_is_deployed.html">Check What&rsquo;s Deployed</a></li>
<li><a href="../faq/deploy_a_specific_build_to_an_environment.html">Deploy a Specific Build</a></li>
<li><a href="../faq/agent_guid_issue.html">Clone/Copy an Existing Agents</a></li>
<li><a href="../faq/job_rerun.html">How do I re-run jobs?</a></li>
<li><a href="../faq/material_update_hung.html">Go unable to poll for changes</a></li>
<li><a href="../faq/artifact_integrity.html">Artifact integrity verification</a></li>
<li><a href="../faq/notifications_page.html">Email Notifications</a></li>
<li><a href="../faq/admin_out_of_disk_space.html">Running out of Disk Space</a></li>
<li><a href="../faq/docker_container_ssh_keys.html">Configure SSH Keys for dockerized GoCD</a></li>
</ul></li>
<li><a href="../beta.html"><strong>Beta features</strong></a>

<ul>
<li><a href="../beta/comment_on_pipeline_run.html">Comment on a pipeline run</a><br /></li>
</ul></li>
<li><a href="../release_history.html"><strong>Release History</strong></a>

<ul>
<li><a href="../release_history/whats_new_in_go.html">What&rsquo;s New in Go</a><br /></li>
</ul></li>
</ul>




</nav>
    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="../svg/menu.svg" />
  </label>
  <strong>Configuration repository Extension</strong>
</header>

      
<article class="markdown">

<h1 id="configuration-repository-extension">Configuration repository Extension</h1>

<p>GoCD supports writing configuration plugins starting <code>16.7</code>.</p>

<p>It is a feature which allows you to move pipeline configurations out of GoCD and its cruise-config.xml file into one or more source-control repositories (e.g. git), so that you can modify them externally. Such modifications will be seen by a periodic poller in the GoCD server and it will <a href="#merging-configurations">merge</a> those pipeline configurations into the pipelines it finds in the main configuration XML file.</p>

<p>Configuration plugins allow users to keep both <strong>pipeline and environment</strong> configurations
in all version control systems supported by GoCD.
Most elements of <strong>pipelines and environments</strong> available in XML are supported by configuration repositories.
However there are a few exceptions, you cannot use in configuration repositories:
 * <a href="../configuration/pipeline_templates.html">GoCD pipeline templates</a>, nor references to templates. <em>Note that you can write a plugin that supports pipeline templates in any way you want</em>
 * parameters</p>

<p>The format in which configurations are stored is fully controlled by the plugin,
so pipelines and environments can be stored for example in JSON, YAML, XML, dot files or any convention that can store necessary information.</p>

<p>There are certain limits involved when using configuration repository:</p>

<ul>
<li>It is not possible to edit remote pipeline or environment using UI</li>
<li>Elements defined via UI cannot refer to external ones. The other way around is possible.</li>
<li>Pipeline templates and parameters are not supported</li>
</ul>

<h2 id="merging-configurations">Merging configurations</h2>

<p>GoCD server polls all materials from pipelines and user-defined configuration repositories.
The final server configuration is merged from <code>cruise-config.xml</code> and remote elements in repositories.
It is important to pay attention to errors introduced in repositories.
It is <strong>highly recommended</strong> to remove any errors as soon as GoCD reports them. For configuration repositories the only way to so is by pushing changes to faulty repository.
All configuration errors are displayed in server health messages.
More details about handling configuration repository errors in GoCD server are <a href="#errors-in-configuration-repository">lower</a>.</p>

<h3 id="merging-pipeline-groups">Merging pipeline groups</h3>

<p>Pipeline&rsquo;s membership in a group can be defined in many configuration repositories and <code>cruise-config.xml</code>.
E.g. group <code>project1</code> can be spread across many configuration repositories,
 then finally in Go server all these pipelines will show up in one group <code>project1</code>.</p>

<h3 id="merging-environments">Merging environments</h3>

<p>Similarly to pipeline groups, final members of environments are a sum of elements in
all configuration repositories. E.g.
 - in repository A we can define that <code>pipeline1</code> is member of environment <code>development</code>
 - in repository B we can define that <code>pipeline2</code> and <code>pipeline3</code> is member of environment <code>development</code>
 - in repository C we can define that <code>pipeline3</code> is member of environment <code>development</code></p>

<p>Then in GoCD server, the final pipelines in environment <code>development</code> are <code>pipeline1</code>, <code>pipeline2</code>, <code>pipeline3</code>.
Notice that <code>pipeline3</code> membership in environment <code>development</code> was declared twice.</p>

<p>Same approach is used for agents.</p>

<p>Environment variables have an additional check. If you assign same environment variable
with 2 different values then it is considered configuration merge conflict.</p>

<h3 id="errors-in-configuration-repository">Errors in configuration repository</h3>

<p>There are several ways in which current configuration can be invalid because of errors in configuration repository.</p>

<h4 id="configuration-repository-plugin-error">Configuration repository plugin Error</h4>

<p>The least problematic situation is when plugin or extension point has detected problems with remote configuration part <em>alone</em>.
Then Go does not attempt to merge this configuration repository and previous configuration part stays <em>active</em>. You should fix errors reported by GoCD server health messages in order to see any new changes from that configuration repository.
If you don&rsquo;t fix such error, there are no other consequences than having old configuration.
Many errors of this type can exist simultaneously - there can be many invalid repositories in <em>this way</em>.</p>

<h4 id="invalid-merged-configuration-error">Invalid Merged Configuration Error</h4>

<p>In some situations it is not possible to create merged configuration from configuration repositories
and main GoCD configuration. Then server health messages reports <strong>Invalid Merged Configuration</strong>.</p>

<p>The common cases that will cause this error are:
 - a pipeline is configured both through UI (in <code>cruise-config.xml</code>) and in on of configuration repositories.
 - pipelines with same name are declared in many configuration repositories.
 - one of the pipelines refers to non-existing pipeline. Or more generally some configuration element refers to other that does not exist.
 - plugin or extension point is not doing enough validations on the remote configuration part <em>alone</em>. This causes server to assemble merged configuration from part which is invalid.</p>

<p>There are <strong>limitations</strong> in how Go server can handle this type of error(s):
1. GoCD can handle situation when there are errors in <strong>exactly one</strong> of the repositories. You will not see new configuration changes from invalid repository until error is fixed. Other configuration repositories and edits to Config XML will be operational. You should fix <strong>Invalid Merged Configuration</strong> anyway to avoid being in next situation&hellip;
2. When <strong>2 or more</strong> configuration repositories are invalid - you <em>may</em> start experiencing being <em>locked out</em> from editing configuration through UI. Changes to XML will be rejected. Reasons for this are beyond scope of this document. You <strong>must fix all configuration repositories first</strong>.</p>

<h2 id="references">References</h2>

<ul>
<li><a href="https://docs.google.com/document/d/1_eGZaqIz9ydnYQJ_Xrcb3obXc-T6jIfV_pgZQNCydVk/edit?pref=2&amp;pli=1">Introduction to configuration repositories</a></li>
<li><a href="https://github.com/gocd/gocd/issues/1133">Github issue</a> including very long debate on how Go should behave</li>
<li><a href="https://github.com/tomzo/gocd-json-config-example">Example configuration repository in JSON</a></li>
<li><a href="https://github.com/tomzo/gocd-yaml-config-example">Example configuration repository in YAML</a></li>
</ul>
</article>

      

    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#configuration-repository-extension">Configuration repository Extension</a>
<ul>
<li><a href="#merging-configurations">Merging configurations</a>
<ul>
<li><a href="#merging-pipeline-groups">Merging pipeline groups</a></li>
<li><a href="#merging-environments">Merging environments</a></li>
<li><a href="#errors-in-configuration-repository">Errors in configuration repository</a>
<ul>
<li><a href="#configuration-repository-plugin-error">Configuration repository plugin Error</a></li>
<li><a href="#invalid-merged-configuration-error">Invalid Merged Configuration Error</a></li>
</ul></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
